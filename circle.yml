dependencies:
    pre:
        # Temporary, using Go 1.7
        - curl -O https://storage.googleapis.com/golang/go1.7.linux-amd64.tar.gz && tar -xvf go1.7.linux-amd64.tar.gz && sudo bash -c 'rm -rf /usr/local/go && mv go /usr/local'
        - go get -u github.com/alecthomas/gometalinter && gometalinter -ui
        - go get -u github.com/jstemmer/go-junit-report
        # Nuking outdated caches that might give problems between language updates
        # see https://github.com/golang/go/issues/12703
        - rm -rf /home/ubuntu/.go_workspace/pkg/*
        - go version
machine:
    environment:
        GODIST: "go1.7.linux-amd64.tar.gz"
        IMPORT_PATH: "github.com/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME"
    post:
        - mkdir -p download
        - test -e download/$GODIST || curl -o download/$GODIST https://storage.googleapis.com/golang/$GODIST
        - sudo rm -rf /usr/local/go
        - sudo tar -C /usr/local -xzf download/$GODIST
    services:
        - docker

test:
    override:
        - go test -v
